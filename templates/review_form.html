{% extends 'base.html' %}

{% block title %}Ressenya de {{ game.title }} - GameBacklog{% endblock %}

{% block content %}
<div class="card" style="max-width: 600px; margin: 0 auto; border-top: 3px solid var(--secondary-color);">
    <h2 style="color: var(--secondary-color); text-transform: uppercase; letter-spacing: 2px;">
        {% if review %}> EDITAR RESSENYA:{% else %}> PUBLICAR NOVA RESSENYA:{% endif %}
        <br>
        <span style="color: #fff; font-size: 1.4rem;">{{ game.title }}</span>
    </h2>

    <form method="POST" action="{{ url_for('review_form', game_id=game.id) }}">
        <div class="form-group mt-2">
            <label for="rating">VALORACIÓ (1..5):</label>
            <select id="rating" name="rating" required style="font-size: 1.1rem;">
                <option value="">A L'ESPERA DE VALORACIÓ...</option>
                <option value="5" {% if review and review.rating==5 %}selected{% endif %}>5 // OBRA MESTRA (★★★★★)
                </option>
                <option value="4" {% if review and review.rating==4 %}selected{% endif %}>4 // MOLT BO (★★★★☆)</option>
                <option value="3" {% if review and review.rating==3 %}selected{% endif %}>3 // BO (★★★☆☆)</option>
                <option value="2" {% if review and review.rating==2 %}selected{% endif %}>2 // REGULAR (★★☆☆☆)</option>
                <option value="1" {% if review and review.rating==1 %}selected{% endif %}>1 // DOLENT (★☆☆☆☆)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="body">TEXT DE LA RESSENYA:</label>
            <textarea id="body" name="body" rows="6" required
                placeholder="Inserir dades d'entorn virtual aquí...">{{ review.body if review else '' }}</textarea>
        </div>

        <div class="form-group flex align-center gap-2"
            style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 6px; border: 1px dashed var(--secondary-color);">
            <div style="position: relative; width: 40px; height: 20px;">
                <input type="checkbox" id="is_public" name="is_public" value="1" {% if not review or review.is_public
                    %}checked{% endif %} style="opacity: 0; width: 0; height: 0;">
                <label for="is_public"
                    style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; box-shadow: inset 0 0 5px rgba(0,0,0,0.5); margin: 0;"></label>
            </div>
            <label for="is_public" style="margin: 0; cursor: pointer; color: #fff; letter-spacing: 1px;">PÚBLICA (TOT EL
                MÓN LA VEU)</label>
            <script>
                document.getElementById('is_public').addEventListener('change', function () {
                    let labelCheck = this.nextElementSibling;
                    let textCheck = labelCheck.nextElementSibling;
                    if (this.checked) {
                        labelCheck.style.backgroundColor = "var(--primary-color)";
                        labelCheck.style.boxShadow = "0 0 10px var(--primary-glow)";
                        textCheck.textContent = "RESSENYA: PÚBLICA (VISIBLE AL CATÀLEG)";
                        textCheck.style.color = "var(--primary-color)";
                    } else {
                        labelCheck.style.backgroundColor = "#555";
                        labelCheck.style.boxShadow = "none";
                        textCheck.textContent = "RESSENYA: PRIVADA (NOMÉS PER TU)";
                        textCheck.style.color = "var(--text-muted)";
                    }
                });
                // Triggers the styles
                document.getElementById('is_public').dispatchEvent(new Event('change'));
            </script>
        </div>
        <small
            style="color: var(--text-muted); display: block; margin-top: -10px; margin-bottom: 25px; font-family: monospace;">
            Desactiva aquesta opció per mantenir la ressenya privada al teu perfil.
        </small>

        <div class="flex gap-2">
            <button type="submit" class="btn" style="flex: 2;">
                {% if review %}GUARDAR CANVIS{% else %}PUBLICAR RESSENYA{% endif %}
            </button>
            <a href="{{ url_for('game_detail', game_id=game.id) }}" class="btn btn-secondary"
                style="flex: 1; text-align: center;">CANCEL·LAR</a>
        </div>
    </form>
</div>

<style>
    /* CSS para el toggle switch visual para checkbox is_public */
    input:checked+label:before {
        transform: translateX(20px);
    }

    label[for="is_public"]:before {
        position: absolute;
        content: "";
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
</style>
{% endblock %}